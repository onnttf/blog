{"id":"D_kwDONzrbkM4AeLc5","title":"GCD åŒæ­¥å¼‚æ­¥ä¸ä¸²è¡Œå¹¶è¡Œçš„æ·±å…¥ç†è§£","body":"å¹¶å‘ç¼–ç¨‹æ˜¯æå‡ `iOS` åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒçš„å…³é”®æŠ€æœ¯ï¼Œè€Œ `Grand Central Dispatch (GCD)` ä½œä¸º `Apple` æ¨å‡ºçš„å¼ºå¤§çº¿ç¨‹ç®¡ç†æ¡†æ¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ç®€æ´è€Œé«˜æ•ˆçš„å¤šçº¿ç¨‹å¼€å‘æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œé¢å¯¹ `GCD` ä¸­åŒæ­¥/å¼‚æ­¥ã€ä¸²è¡Œ/å¹¶è¡Œç­‰å¤šç§ç»„åˆæ–¹å¼ï¼Œå¾ˆå¤šå¼€å‘è€…å¾€å¾€æ„Ÿåˆ°å›°æƒ‘ï¼Œæ— æ³•å……åˆ†å‘æŒ¥å…¶æ€§èƒ½ä¼˜åŠ¿ã€‚\r\n\r\næœ¬æ–‡å°†ä»¥é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æ·±å…¥å‰–æ `GCD` çš„æ ¸å¿ƒæ¦‚å¿µï¼Œé€šè¿‡å¤§é‡å®ä¾‹å’Œè¯¦ç»†è§£æï¼Œå¸®åŠ©ä½ å…¨é¢ç†è§£çº¿ç¨‹æ‰§è¡Œçš„å…³é”®ç»†èŠ‚ï¼ŒæŒæ¡åœ¨å®é™…å¼€å‘ä¸­çµæ´»è¿ç”¨è¿™äº›æŠ€æœ¯çš„æœ€ä½³å®è·µã€‚\r\n\r\n## æ ¸å¿ƒæ¦‚å¿µè§£æ\r\n\r\nåœ¨å¼€å§‹æ·±å…¥å­¦ä¹  `GCD` ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆé€šè¿‡ç”ŸåŠ¨çš„ç±»æ¯”æ¥ç†è§£å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š\r\n\r\n- **çº¿ç¨‹**\r\n\r\n  ä¸€æ¡ç”Ÿäº§çº¿ä¸Šçš„å·¥äººï¼š\r\n\r\n  - æ˜¯æ‰§è¡Œå…·ä½“å·¥ä½œçš„æœ€å°å•ä½\r\n  - ç”±å·¥å‚ï¼ˆ`CPU`ï¼‰ç»Ÿä¸€è°ƒåº¦å®‰æ’å·¥ä½œ\r\n  - å¯ä»¥ç‹¬ç«‹å®Œæˆåˆ†é…çš„ä»»åŠ¡\r\n  - å¤šä¸ªå·¥äººå¯ä»¥åŒæ—¶å·¥ä½œ\r\n\r\n- **ä»»åŠ¡**\r\n\r\n  å·¥å‚é‡Œéœ€è¦å®Œæˆçš„å…·ä½“å·¥ä½œï¼š\r\n\r\n  - ä¸€ä»¶æ˜ç¡®çš„å·¥ä½œï¼ˆå¦‚ç»„è£…ä¸€ä¸ªé›¶ä»¶ï¼‰\r\n  - å¯ä»¥ç”¨ä¸åŒæ–¹å¼æè¿°ï¼ˆä»»åŠ¡æ¸…å•æˆ–å£å¤´æŒ‡ä»¤ï¼‰\r\n  - åŒ…å«å…·ä½“çš„æ“ä½œæ­¥éª¤å’Œç›®æ ‡\r\n\r\n- **é˜Ÿåˆ—**\r\n\r\n  å·¥å‚çš„ä»»åŠ¡åˆ†å‘é€šé“ï¼š\r\n\r\n  - ä»»åŠ¡æŒ‰ç…§å…ˆæ¥å…ˆåšçš„é¡ºåºæ’é˜Ÿ\r\n  - ç»Ÿä¸€ç®¡ç†å¾…å¤„ç†çš„å·¥ä½œ\r\n  - å†³å®šå·¥äººå¦‚ä½•é¢†å–å’Œæ‰§è¡Œä»»åŠ¡\r\n\r\n- **ä¸²è¡Œé˜Ÿåˆ—**\r\n\r\n  ä¸€æ¡çš„ç”Ÿäº§çº¿ï¼š\r\n\r\n  - ä¸€ä¸ªå·¥äººæŒ‰é¡ºåºå¤„ç†\r\n  - å¿…é¡»ä¸€ä¸ªä»»åŠ¡åšå®Œå†åšä¸‹ä¸€ä¸ª\r\n  - é€‚åˆæœ‰å…ˆåé¡ºåºè¦æ±‚çš„å·¥ä½œ\r\n\r\n- **å¹¶è¡Œé˜Ÿåˆ—**\r\n\r\n  å¤šæ¡å¹¶è¡Œçš„ç”Ÿäº§çº¿ï¼š\r\n\r\n  - å¤šä¸ªå·¥äººå¯ä»¥åŒæ—¶å·¥ä½œ\r\n  - å¤šä¸ªä»»åŠ¡å¯ä»¥åŒæ­¥è¿›è¡Œ\r\n  - é€‚åˆå¯ä»¥ç‹¬ç«‹å®Œæˆçš„å·¥ä½œ\r\n\r\n- **åŒæ­¥æ‰§è¡Œ**\r\n\r\n  ç­‰å¾…å·¥äººå½“åœºå®Œæˆä»»åŠ¡ï¼š\r\n\r\n  - å·¥äººä¸èƒ½åŒæ—¶åšå…¶ä»–äº‹\r\n  - å¿…é¡»ç­‰è¿™ä»¶äº‹åšå®Œæ‰èƒ½ç»§ç»­\r\n  - ä»»åŠ¡æŒ‰é¡ºåºé€ä¸ªå®Œæˆ\r\n\r\n- **å¼‚æ­¥æ‰§è¡Œ**\r\n\r\n  åˆ†é…ä»»åŠ¡åä¸ç”¨ç­‰å¾…ï¼š\r\n\r\n  - å¯ä»¥è°ƒç”¨å¤šä¸ªå·¥äººåŒæ—¶å·¥ä½œ\r\n  - ä»»åŠ¡å¯ä»¥å¹¶è¡Œå¤„ç†\r\n  - åˆ†é…å®Œå°±å¯ä»¥åšå…¶ä»–äº‹\r\n\r\n## GCD å®æˆ˜æŒ‡å—\r\n\r\nè®©æˆ‘ä»¬é€šè¿‡è¯¦ç»†çš„ä»£ç ç¤ºä¾‹å’Œæ‰§è¡Œç»“æœåˆ†æï¼Œå…¨é¢æŒæ¡ `GCD` ä¸­å„ç§æ‰§è¡Œç»„åˆæ–¹å¼ã€‚æ¯ä¸ªç»„åˆéƒ½é…æœ‰å®Œæ•´çš„ç¤ºä¾‹ä»£ç ã€æ‰§è¡Œç‰¹ç‚¹è¯´æ˜å’Œå®é™…è¿è¡Œæ•ˆæœã€‚\r\n\r\n### åŒæ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸¥æ ¼æŒ‰åºæ‰§è¡Œ\r\n\r\nç‰¹ç‚¹ï¼š\r\n\r\n- åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œ\r\n- ä»»åŠ¡æŒ‰ä¸¥æ ¼é¡ºåºä¾æ¬¡æ‰§è¡Œ\r\n- éœ€ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆæ‰èƒ½ç»§ç»­\r\n\r\n```objc\r\ndispatch_queue_t queue = dispatch_queue_create(\"blog.onnttf.site\", DISPATCH_QUEUE_SERIAL);\r\nNSLog(@\"---start---%@\", [NSThread currentThread]);\r\n\r\ndispatch_sync(queue, ^{\r\n    sleep(5);\r\n    NSLog(@\"ä»»åŠ¡ 1---%@\", [NSThread currentThread]);\r\n});\r\n\r\ndispatch_sync(queue, ^{\r\n    sleep(3);\r\n    NSLog(@\"ä»»åŠ¡ 2---%@\", [NSThread currentThread]);\r\n});\r\n\r\ndispatch_sync(queue, ^{\r\n    sleep(1);\r\n    NSLog(@\"ä»»åŠ¡ 3---%@\", [NSThread currentThread]);\r\n});\r\n\r\nNSLog(@\"---end---%@\", [NSThread currentThread]);\r\n\r\n/**\r\n æ§åˆ¶å°è¾“å‡ºï¼š\r\n ---start---<NSThread: 0x6000000741c0>{number = 1, name = main}\r\n ä»»åŠ¡ 1---<NSThread: 0x6000000741c0>{number = 1, name = main}\r\n ä»»åŠ¡ 2---<NSThread: 0x6000000741c0>{number = 1, name = main}\r\n ä»»åŠ¡ 3---<NSThread: 0x6000000741c0>{number = 1, name = main}\r\n ---end---<NSThread: 0x6000000741c0>{number = 1, name = main}\r\n*/\r\n```\r\n\r\n### åŒæ­¥æ‰§è¡Œ + å¹¶è¡Œé˜Ÿåˆ—ï¼šé¡ºåºæ‰§è¡Œä½†å¯å¤šçº¿ç¨‹\r\n\r\nç‰¹ç‚¹ï¼š\r\n\r\n- è™½ä¸ºå¹¶è¡Œé˜Ÿåˆ—ä½†åŒæ­¥æ‰§è¡Œå¯¼è‡´é¡ºåºæ‰§è¡Œ\r\n- ä»åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ\r\n- ä»»åŠ¡å®Œæˆåæ‰æ‰§è¡Œä¸‹ä¸€ä¸ª\r\n\r\n```objc\r\ndispatch_queue_t queue = dispatch_queue_create(\"concurrent.queue\", DISPATCH_QUEUE_CONCURRENT);\r\n\r\nNSLog(@\"---start---%@\", [NSThread currentThread]);\r\n\r\ndispatch_sync(queue, ^{\r\n    sleep(3);\r\n    NSLog(@\"ä»»åŠ¡1---%@\", [NSThread currentThread]);\r\n});\r\n\r\ndispatch_sync(queue, ^{\r\n    sleep(2);\r\n    NSLog(@\"ä»»åŠ¡2---%@\", [NSThread currentThread]);\r\n});\r\n\r\nNSLog(@\"---end---%@\", [NSThread currentThread]);\r\n\r\n/* è¾“å‡ºç»“æœï¼š\r\n ---start---<NSThread: main>\r\n ä»»åŠ¡1---<NSThread: main>   // 3ç§’å\r\n ä»»åŠ¡2---<NSThread: main>   // 2ç§’å\r\n ---end---<NSThread: main>\r\n*/\r\n```\r\n\r\n### å¼‚æ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ—ï¼šå¼€å¯æ–°çº¿ç¨‹é¡ºåºæ‰§è¡Œ\r\n\r\nç‰¹ç‚¹ï¼š\r\n\r\n- ä¼šå¼€å¯æ–°çš„çº¿ç¨‹\r\n- ä»»åŠ¡åœ¨æ–°çº¿ç¨‹ä¸­æŒ‰é¡ºåºæ‰§è¡Œ\r\n- ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹\r\n\r\n```objc\r\ndispatch_queue_t queue = dispatch_queue_create(\"serial.queue\", DISPATCH_QUEUE_SERIAL);\r\n\r\nNSLog(@\"---start---%@\", [NSThread currentThread]);\r\n\r\ndispatch_async(queue, ^{\r\n    sleep(3);\r\n    NSLog(@\"ä»»åŠ¡1---%@\", [NSThread currentThread]);\r\n});\r\n\r\ndispatch_async(queue, ^{\r\n    sleep(2);\r\n    NSLog(@\"ä»»åŠ¡2---%@\", [NSThread currentThread]);\r\n});\r\n\r\nNSLog(@\"---end---%@\", [NSThread currentThread]);\r\n\r\n/* è¾“å‡ºç»“æœï¼š\r\n ---start---<NSThread: main>\r\n ---end---<NSThread: main>\r\n ä»»åŠ¡1---<NSThread: {number = 2}>   // 3ç§’å\r\n ä»»åŠ¡2---<NSThread: {number = 2}>   // 2ç§’å\r\n*/\r\n```\r\n\r\n### å¼‚æ­¥æ‰§è¡Œ + å¹¶è¡Œé˜Ÿåˆ—ï¼šå¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œ\r\n\r\nç‰¹ç‚¹ï¼š\r\n\r\n- å¼€å¯å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ\r\n- ä»»åŠ¡æ‰§è¡Œé¡ºåºä¸ç¡®å®š\r\n- æ•ˆç‡æœ€é«˜çš„æ‰§è¡Œæ–¹å¼\r\n\r\n```objc\r\ndispatch_queue_t queue = dispatch_queue_create(\"concurrent.queue\", DISPATCH_QUEUE_CONCURRENT);\r\n\r\nNSLog(@\"---start---%@\", [NSThread currentThread]);\r\n\r\ndispatch_async(queue, ^{\r\n    sleep(3);\r\n    NSLog(@\"ä»»åŠ¡1---%@\", [NSThread currentThread]);\r\n});\r\n\r\ndispatch_async(queue, ^{\r\n    sleep(2);\r\n    NSLog(@\"ä»»åŠ¡2---%@\", [NSThread currentThread]);\r\n});\r\n\r\nNSLog(@\"---end---%@\", [NSThread currentThread]);\r\n\r\n/* è¾“å‡ºç»“æœï¼š\r\n ---start---<NSThread: main>\r\n ---end---<NSThread: main>\r\n ä»»åŠ¡2---<NSThread: {number = 3}>   // 2ç§’å\r\n ä»»åŠ¡1---<NSThread: {number = 2}>   // 3ç§’å\r\n*/\r\n```\r\n\r\n### åŒæ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ—ï¼šæ­»é”é£é™©\r\n\r\nç‰¹ç‚¹ï¼š\r\n\r\n- åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œä¼šé€ æˆæ­»é”\r\n- åº”é¿å…åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨æ­¤ç»„åˆ\r\n- å¸¸è§çš„çº¿ç¨‹å®‰å…¨éšæ‚£\r\n\r\n```objc\r\ndispatch_queue_t queue = dispatch_get_main_queue();\r\n\r\nNSLog(@\"---start---%@\", [NSThread currentThread]);\r\n\r\n// ä¼šå¯¼è‡´æ­»é”\r\ndispatch_sync(queue, ^{\r\n    NSLog(@\"ä»»åŠ¡1---%@\", [NSThread currentThread]);\r\n});\r\n\r\nNSLog(@\"---end---%@\", [NSThread currentThread]);\r\n\r\n/* è¾“å‡ºç»“æœï¼š\r\n ---start---<NSThread: main>\r\n // ç¨‹åºæ­»é”\r\n*/\r\n```\r\n\r\n### å¼‚æ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ—ï¼šä¸»çº¿ç¨‹å®‰å…¨æ‰§è¡Œ\r\n\r\nç‰¹ç‚¹ï¼š\r\n\r\n- ç¡®ä¿ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ\r\n- é€‚åˆ `UI` æ“ä½œç›¸å…³ä»»åŠ¡\r\n- ä¸ä¼šé€ æˆæ­»é”é—®é¢˜\r\n\r\n```objc\r\ndispatch_queue_t queue = dispatch_get_main_queue();\r\n\r\nNSLog(@\"---start---%@\", [NSThread currentThread]);\r\n\r\ndispatch_async(queue, ^{\r\n    sleep(3);\r\n    NSLog(@\"ä»»åŠ¡1---%@\", [NSThread currentThread]);\r\n});\r\n\r\ndispatch_async(queue, ^{\r\n    sleep(2);\r\n    NSLog(@\"ä»»åŠ¡2---%@\", [NSThread currentThread]);\r\n});\r\n\r\nNSLog(@\"---end---%@\", [NSThread currentThread]);\r\n\r\n/* è¾“å‡ºç»“æœï¼š\r\n ---start---<NSThread: main>\r\n ---end---<NSThread: main>\r\n ä»»åŠ¡1---<NSThread: main>   // 3ç§’å\r\n ä»»åŠ¡2---<NSThread: main>   // 2ç§’å\r\n*/\r\n```\r\n\r\n## æœ€å\r\n\r\né€šè¿‡æœ¬æ–‡çš„è¯¦ç»†è®²è§£ï¼Œæˆ‘ä»¬ç³»ç»Ÿåœ°å­¦ä¹ äº† `GCD` ä¸­çš„æ ¸å¿ƒæ¦‚å¿µå’Œå„ç§æ‰§è¡Œç»„åˆæ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å…³é”®è¦ç‚¹æ€»ç»“ï¼š\r\n\r\n- åŒæ­¥/å¼‚æ­¥å†³å®šæ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹\r\n\r\n  - åŒæ­¥æ‰§è¡Œä¼šç­‰å¾…ä»»åŠ¡å®Œæˆ\r\n  - å¼‚æ­¥æ‰§è¡Œç«‹å³è¿”å›ç»§ç»­æ‰§è¡Œ\r\n\r\n- ä¸²è¡Œ/å¹¶è¡Œå†³å®šä»»åŠ¡æ‰§è¡Œæ–¹å¼\r\n\r\n  - ä¸²è¡Œé˜Ÿåˆ—æŒ‰é¡ºåºæ‰§è¡Œä»»åŠ¡\r\n  - å¹¶è¡Œé˜Ÿåˆ—å¯åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡\r\n\r\n- å¸¸è§ä½¿ç”¨åœºæ™¯\r\n\r\n  - `UI` æ“ä½œä¼˜å…ˆä½¿ç”¨ä¸»é˜Ÿåˆ—\r\n  - è€—æ—¶æ“ä½œä½¿ç”¨å¼‚æ­¥å¹¶è¡Œé˜Ÿåˆ—\r\n  - æœ‰åºæ“ä½œä½¿ç”¨ä¸²è¡Œé˜Ÿåˆ—\r\n  - é¿å…ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œé€ æˆæ­»é”\r\n\r\nåœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„ç»„åˆæ–¹å¼ã€‚åˆç†è¿ç”¨è¿™äº›ç‰¹æ€§ï¼Œæ—¢å¯ä»¥ä¿è¯ä»£ç çš„æ­£ç¡®æ€§ï¼Œåˆèƒ½å……åˆ†å‘æŒ¥ç³»ç»Ÿæ€§èƒ½ï¼Œä»è€Œå¼€å‘å‡ºé«˜æ•ˆç¨³å®šçš„åº”ç”¨ç¨‹åºã€‚\r\n","number":12,"labels":{"nodes":[{"id":"LA_kwDONzrbkM8AAAAB4nYwyw","name":"iOS","url":"https://github.com/onnttf/blog/labels/iOS"}]},"category":{"id":"DIC_kwDONzrbkM4Cmnbf","name":"Show and tell","slug":"show-and-tell","emoji":":raised_hands:","emojiHTML":"<div>ğŸ™Œ</div>"},"author":{"login":"onnttf"},"authorAssociation":"OWNER","createdAt":"2018-05-29T08:00:00Z","updatedAt":"2025-02-03T15:39:10Z","repository":{"id":"R_kgDONzrbkA","url":"https://github.com/onnttf/blog"},"url":"https://github.com/onnttf/blog/discussions/12","updatedAtTimestamp":1738597150,"jsonFilePath":"discussions/12-D_kwDONzrbkM4AeLc5.json","markdownFilePath":"2018/5/12-D_kwDONzrbkM4AeLc5.md"}
