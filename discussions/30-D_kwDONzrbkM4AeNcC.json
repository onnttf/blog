{"id":"D_kwDONzrbkM4AeNcC","title":"å¦‚ä½•æ„å»º Docker é•œåƒ","body":"## Docker é•œåƒæ˜¯ä»€ä¹ˆ\r\n\r\nDocker é•œåƒæ˜¯å®¹å™¨è¿è¡Œæ—¶çš„åªè¯»æ¨¡æ¿ï¼Œå®ƒåŒ…å«äº†è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€åˆ‡ï¼šä»£ç ã€è¿è¡Œæ—¶ç¯å¢ƒã€ç³»ç»Ÿå·¥å…·ã€ç³»ç»Ÿåº“å’Œè®¾ç½®ç­‰ã€‚[Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/get-started/overview/)å¯¹é•œåƒçš„å®šä¹‰å¦‚ä¸‹ï¼š\r\n\r\n> An image is a read-only template with instructions for creating a Docker container. Often, an image is based on another image, with some additional customization. For example, you may build an image which is based on the ubuntu image, but installs the Apache web server and your application, as well as the configuration details needed to make your application run.\r\n\r\nç®€å•æ¥è¯´ï¼ŒDocker é•œåƒå°±åƒæ˜¯ä¸€ä¸ª\"å¿«ç…§\"ï¼Œå®ƒå¯ä»¥ä¿å­˜å¹¶å¤åˆ¶ä¸€ä¸ªå®Œæ•´çš„è¿è¡Œç¯å¢ƒã€‚\r\n\r\n## ä¸‰ç§æ„å»ºé•œåƒçš„æ–¹æ³•\r\n\r\nDocker æä¾›äº†ä¸‰ç§ä¸»æµçš„æ„å»ºé•œåƒæ–¹å¼ï¼š\r\n\r\n1. ä½¿ç”¨ `Dockerfile` æ„å»ºï¼ˆæ¨èï¼‰\r\n2. åŸºäºå·²æœ‰é•œåƒæ„å»º\r\n3. åŸºäºå®¹å™¨æ„å»º\r\n\r\nè®©æˆ‘ä»¬è¯¦ç»†äº†è§£æ¯ç§æ–¹æ³•ã€‚\r\n\r\n### ä½¿ç”¨ Dockerfile æ„å»ºé•œåƒï¼ˆæ¨èï¼‰\r\n\r\n`Dockerfile` æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«æ„å»ºé•œåƒæ‰€éœ€çš„æ‰€æœ‰[å‘½ä»¤](https://docs.docker.com/engine/reference/builder/)ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•ä¸”å¯é‡å¤çš„æ–¹å¼æ¥åˆ›å»ºé•œåƒã€‚\r\n\r\nä¸‹é¢é€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ `Dockerfile` æ„å»ºä¸€ä¸ªåŒ…å« `vim` ç¼–è¾‘å™¨çš„é•œåƒï¼š\r\n\r\n1. åˆ›å»ºå·¥ä½œç›®å½•\r\n\r\n   ```bash\r\n   ~/Desktop\r\n   â¯ mkdir vim && cd vim\r\n   ~/Desktop/vim\r\n   â¯\r\n   ```\r\n\r\n2. ç¼–å†™ Dockerfile\r\n\r\n   ```dockerfile\r\n   # æŒ‡å®šåŸºç¡€é•œåƒ\r\n   FROM ubuntu:latest\r\n   # é•œåƒä½œè€…åŠè”ç³»æ–¹å¼\r\n   LABEL author=\"zhangpeng\" \\\r\n       mail=\"onnttf@gmail.com\"\r\n   # æ›´æ–°æº\r\n   RUN sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\r\n   RUN sed -i 's/security.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\r\n   # æ›´æ–°å¯ç”¨åŒ…\r\n   RUN apt update \\\r\n       && apt full-upgrade -y\r\n   # å®‰è£… vim\r\n   RUN apt -y install vim\r\n   # æ¸…ç† apt ç¼“å­˜\r\n   RUN apt autoremove -y \\\r\n       && apt clean -y \\\r\n       && rm -rf /var/lib/apt/lists/*\r\n   ```\r\n\r\n   > æç¤ºï¼šDockerfile è¿˜æ”¯æŒ `CMD`ã€`ENV`ã€`ENTRYPOINT` ç­‰å¤šç§æŒ‡ä»¤ï¼Œè¯¦è§[å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/engine/reference/builder/)ã€‚\r\n\r\n3. æ„å»ºé•œåƒ\r\n\r\n   æ‰§è¡Œ `docker build` å‘½ä»¤ï¼š\r\n\r\n   ```bash\r\n   âœ  vim docker build -t vim .\r\n   [+] Building 0.1s (10/10) FINISHED\r\n   => [internal] load build definition from Dockerfile               0.0s\r\n   => => transferring dockerfile: 37B                                0.0s\r\n   => [internal] load .dockerignore                                  0.0s\r\n   => => transferring context: 2B                                    0.0s\r\n   => [internal] load metadata for docker.io/library/ubuntu:latest   0.0s\r\n   => [1/6] FROM docker.io/library/ubuntu:latest                     0.0s\r\n   => CACHED [2/6] RUN sed -i 's/archive.ubuntu.com/mirrors.ustc.ed  0.0s\r\n   => CACHED [3/6] RUN sed -i 's/security.ubuntu.com/mirrors.ustc.e  0.0s\r\n   => CACHED [4/6] RUN apt update     && apt full-upgrade -y         0.0s\r\n   => CACHED [5/6] RUN apt -y install vim                            0.0s\r\n   => CACHED [6/6] RUN apt autoremove -y     && apt clean -y     &&  0.0s\r\n   => exporting to image                                             0.0s\r\n   => => exporting layers                                            0.0s\r\n   => => writing image sha256:0350ae574b3e008092a110a818d266ab1dc45  0.0s\r\n   => => naming to docker.io/library/vim                             0.0s\r\n\r\n   Use 'docker scan' to run Snyk tests against images to find vulnerabilities and learn how to fix them\r\n   ```\r\n\r\n### åŸºäºå·²æœ‰é•œåƒæ„å»º\r\n\r\nå·²æœ‰é•œåƒå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\r\n\r\n- å¸¦æ–‡ä»¶ç³»ç»Ÿçš„é•œåƒï¼šé€šè¿‡ [docker export](https://docs.docker.com/engine/reference/commandline/export/) å¯¼å‡ºï¼Œéœ€ä½¿ç”¨ [docker import](https://docs.docker.com/engine/reference/commandline/import/) å¯¼å…¥\r\n\r\n  ```bash\r\n  â¯ docker import --help\r\n\r\n  Usage:  docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]\r\n\r\n  Import the contents from a tarball to create a filesystem image\r\n\r\n  Aliases:\r\n  docker image import, docker import\r\n\r\n  Options:\r\n  -c, --change list       Apply Dockerfile instruction to the created image\r\n  -m, --message string    Set commit message for imported image\r\n      --platform string   Set platform if server is multi-platform capable\r\n  ```\r\n\r\n- æ™®é€šé•œåƒï¼šé€šè¿‡ [docker save](https://docs.docker.com/engine/reference/commandline/save/) å¯¼å‡ºï¼Œéœ€ä½¿ç”¨ [docker load](https://docs.docker.com/engine/reference/commandline/load/) å¯¼å…¥\r\n\r\n  ```bash\r\n  â¯ docker save --help\r\n\r\n  Usage:  docker save [OPTIONS] IMAGE [IMAGE...]\r\n\r\n  Save one or more images to a tar archive (streamed to STDOUT by default)\r\n\r\n  Aliases:\r\n  docker image save, docker save\r\n\r\n  Options:\r\n  -o, --output string   Write to a file, instead of STDOUT\r\n  ```\r\n\r\n### åŸºäºå®¹å™¨æ„å»ºé•œåƒ\r\n\r\nè¿™ç§æ–¹å¼ä¸»è¦ç”¨äºä¿å­˜å®¹å™¨çš„è¿è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚ï¼š\r\n\r\n- è°ƒè¯•å¼‚å¸¸é—®é¢˜\r\n- ä¿å­˜ CPU/å†…å­˜å¼‚å¸¸ç°åœº\r\n- å¤ç° Bug åœºæ™¯\r\n\r\nä½¿ç”¨ [docker commit](https://docs.docker.com/engine/reference/commandline/commit/) å‘½ä»¤å¯ä»¥å°†å®¹å™¨ä¿å­˜ä¸ºæ–°çš„é•œåƒï¼š\r\n\r\n```bash\r\nâ¯ docker commit --help\r\n\r\nUsage:  docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]\r\n\r\nCreate a new image from a container's changes\r\n\r\nAliases:\r\n  docker container commit, docker commit\r\n\r\nOptions:\r\n  -a, --author string    Author (e.g., \"John Hannibal Smith <hannibal@a-team.com>\")\r\n  -c, --change list      Apply Dockerfile instruction to the created image\r\n  -m, --message string   Commit message\r\n  -p, --pause            Pause container during commit (default true)\r\n```\r\n\r\n## æœ€å\r\n\r\næœ¬æ–‡è¯¦ç»†ä»‹ç»äº†æ„å»º Docker é•œåƒçš„ä¸‰ç§æ–¹æ³•ï¼Œå…¶ä¸­[é€šè¿‡ Dockerfile æ„å»ºé•œåƒ](#ä½¿ç”¨-dockerfile-æ„å»ºé•œåƒæ¨è)æ˜¯æœ€æ¨èçš„æ–¹å¼ï¼Œå› ä¸ºå®ƒï¼š\r\n\r\n- è¿‡ç¨‹æ¸…æ™°é€æ˜\r\n- æ˜“äºç»´æŠ¤å’Œç‰ˆæœ¬æ§åˆ¶\r\n- å¯é‡å¤ä½¿ç”¨\r\n- é€‚åˆè‡ªåŠ¨åŒ–æ„å»º\r\n\r\nå»ºè®®ä½ ä»ç¼–å†™ç®€å•çš„ `Dockerfile` å¼€å§‹ï¼Œé€æ­¥æŒæ¡ Docker é•œåƒçš„æ„å»ºæŠ€å·§ã€‚\r\n","number":30,"labels":{"nodes":[]},"category":{"id":"DIC_kwDONzrbkM4Cmnbf","name":"Show and tell","slug":"show-and-tell","emoji":":raised_hands:","emojiHTML":"<div>ğŸ™Œ</div>"},"author":{"login":"onnttf"},"authorAssociation":"OWNER","createdAt":"2023-03-01T08:00:00Z","updatedAt":"2025-02-05T11:54:37Z","repository":{"id":"R_kgDONzrbkA","url":"https://github.com/onnttf/blog"},"url":"https://github.com/onnttf/blog/discussions/30","jsonFilePath":"discussions/30-D_kwDONzrbkM4AeNcC.json","markdownFilePath":"2023/03/30-D_kwDONzrbkM4AeNcC.md"}
