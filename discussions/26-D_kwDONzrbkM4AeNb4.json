{"id":"D_kwDONzrbkM4AeNb4","title":"Go Modulesï¼šè½»æ¾æå®š Go é¡¹ç›®ä¾èµ–ç®¡ç†","body":"åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œä¾èµ–ç®¡ç†æ˜¯ä¸€ä¸ªæ£˜æ‰‹ä¸”å…³é”®çš„ä»»åŠ¡ï¼Œæ¶‰åŠç‰ˆæœ¬å…¼å®¹ã€åŒ…å†²çªå’Œå¤æ‚ä¾èµ–å…³ç³»çš„åè°ƒç­‰å·¥ä½œã€‚ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼ŒGo è¯­è¨€å›¢é˜Ÿåœ¨ `Go 1.11` ç‰ˆæœ¬ä¸­å¼•å…¥äº†åŒ…ç®¡ç†å·¥å…· Go Modulesï¼Œå®ƒä¸º Go ç”Ÿæ€ç³»ç»Ÿå¸¦æ¥äº†ä¸€ä¸ªå¼ºå¤§è€Œä¼˜é›…çš„ä¾èµ–ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚\r\n\r\n## Go Modules æ˜¯ä»€ä¹ˆ\r\n\r\nGo Modules æ˜¯ Go è¯­è¨€å®˜æ–¹æ¨å‡ºçš„ä¾èµ–ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒå½»åº•æ‘†è„±äº†å¯¹ `GOPATH` çš„ä¾èµ–ï¼Œä¸º Go é¡¹ç›®å¸¦æ¥äº†å…¨æ–°çš„åŒ…ç®¡ç†ä½“éªŒã€‚è¿™ä¸ªå¼ºå¤§çš„å·¥å…·äº `Go 1.11` ç‰ˆæœ¬é¦–æ¬¡å¼•å…¥ï¼Œå¹¶åœ¨ `Go 1.13` ç‰ˆæœ¬æˆä¸ºé»˜è®¤çš„ä¾èµ–ç®¡ç†æ–¹å¼ã€‚\r\n\r\nGo Modules çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š\r\n\r\n1. **æ™ºèƒ½åŒ–ä¾èµ–ç®¡ç†**ï¼š\r\n\r\n   - è‡ªåŠ¨ä¸‹è½½å’Œæ›´æ–°ä¾èµ–\r\n   - è‡ªåŠ¨è§£å†³ä¾èµ–å†²çª\r\n   - æ”¯æŒå¤šç‰ˆæœ¬ä¾èµ–å…±å­˜\r\n\r\n2. **é¡¹ç›®ç»“æ„çµæ´»**ï¼š\r\n\r\n   - ä¸å†å—é™äº `$GOPATH/src` ç›®å½•\r\n   - å¯ä»¥åœ¨ä»»æ„ä½ç½®åˆ›å»ºå’Œç®¡ç†é¡¹ç›®\r\n   - æ›´ç¬¦åˆç°ä»£å¼€å‘å·¥ä½œæµ\r\n\r\n3. **ä¾èµ–è¿½è¸ªé€æ˜**ï¼š\r\n\r\n   - ä½¿ç”¨ `go.mod` æ–‡ä»¶æ¸…æ™°è®°å½•æ‰€æœ‰ä¾èµ–\r\n   - æ”¯æŒè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶\r\n   - ä¾èµ–å…³ç³»ä¸€ç›®äº†ç„¶\r\n\r\n4. **ç‰ˆæœ¬ç®¡ç†å¯é **ï¼š\r\n\r\n   - ç²¾ç¡®é”å®šä¾èµ–ç‰ˆæœ¬\r\n   - ç¡®ä¿æ„å»ºçš„å¯é‡ç°æ€§\r\n   - æ–¹ä¾¿å›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬\r\n\r\n5. **ç”Ÿæ€ç³»ç»Ÿå‹å¥½**ï¼š\r\n\r\n   - å®Œæ•´çš„æ¨¡å—ä»£ç†æœºåˆ¶\r\n   - ç§æœ‰æ¨¡å—æ”¯æŒ\r\n   - ä¸ä¸»æµä»£ç æ‰˜ç®¡å¹³å°æ— ç¼é›†æˆ\r\n\r\n## Go Modules å®è·µ\r\n\r\nè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹é¡¹ç›®æ¥å­¦ä¹  Go Modules çš„ä½¿ç”¨ã€‚æœ¬å®è·µå°†åŒ…å«åˆ›å»ºåŸºç¡€åº“ã€ä½¿ç”¨ä¾èµ–ä»¥åŠå‘å¸ƒæ¨¡å—çš„å®Œæ•´æµç¨‹ã€‚\r\n\r\n### åˆ›å»ºåŸºç¡€åº“\r\n\r\né¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º `greetings` çš„åŸºç¡€åº“æ¨¡å—ã€‚\r\n\r\n1. åˆ›å»ºå¹¶åˆå§‹åŒ–æ¨¡å—\r\n\r\n   ```bash\r\n   # åˆ›å»ºå¹¶è¿›å…¥é¡¹ç›®ç›®å½•\r\n   $ mkdir greetings && cd greetings\r\n\r\n   # åˆå§‹åŒ– Go æ¨¡å—\r\n   $ go mod init github.com/onnttf/greetings\r\n   go: creating new go.mod: module github.com/onnttf/greetings\r\n\r\n   # æŸ¥çœ‹ç”Ÿæˆçš„ go.mod æ–‡ä»¶\r\n   $ cat go.mod\r\n   module github.com/onnttf/greetings\r\n\r\n   go 1.22.6\r\n   ```\r\n\r\n   **è¯´æ˜**: `go mod init` å‘½ä»¤ä¼šç”Ÿæˆ `go.mod` æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¨¡å—åç§°å’Œ Go ç‰ˆæœ¬ä¿¡æ¯ï¼Œç”¨äºç®¡ç†ä¾èµ–å…³ç³»ã€‚\r\n\r\n2. ç¼–å†™åŠŸèƒ½ä»£ç \r\n\r\n   åˆ›å»º `greetings.go` æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š\r\n\r\n   ```go\r\n   package greetings\r\n\r\n   import \"fmt\"\r\n\r\n   // Hello returns a greeting for the named person.\r\n   func Hello(name string) string {\r\n       message := fmt.Sprintf(\"Hi, %v. Welcome!\", name)\r\n       return message\r\n   }\r\n   ```\r\n\r\n### åˆ›å»ºä¸»é¡¹ç›®\r\n\r\næ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®æ¥ä½¿ç”¨æˆ‘ä»¬çš„ `greetings` æ¨¡å—ã€‚\r\n\r\n1. åˆå§‹åŒ–é¡¹ç›®ç»“æ„\r\n\r\n   ```bash\r\n   $ cd ..\r\n   # åˆ›å»ºå¹¶è¿›å…¥é¡¹ç›®ç›®å½•\r\n   $ mkdir hello && cd hello\r\n   # åˆå§‹åŒ–æ–°æ¨¡å—\r\n   $ go mod init github.com/onnttf/hello\r\n   go: creating new go.mod: module github.com/onnttf/hello\r\n   ```\r\n\r\n2. åˆ›å»ºä¸»ç¨‹åº\r\n\r\n   ç¼–å†™ `hello.go` æ–‡ä»¶ï¼š\r\n\r\n   ```go\r\n   package main\r\n\r\n   import (\r\n       \"fmt\"\r\n       \"github.com/onnttf/greetings\"  // å¯¼å…¥æˆ‘ä»¬çš„ greetings æ¨¡å—\r\n   )\r\n\r\n   func main() {\r\n       message := greetings.Hello(\"Mike\")\r\n       fmt.Println(message)\r\n   }\r\n   ```\r\n\r\n3. é…ç½®æœ¬åœ°ä¾èµ–\r\n\r\n   ç”±äº greetings æ¨¡å—è¿˜æœªå‘å¸ƒï¼Œæˆ‘ä»¬éœ€è¦å…ˆé…ç½®æœ¬åœ°ä¾èµ–ï¼š\r\n\r\n   ```bash\r\n   # å°†æ¨¡å—æŒ‡å‘æœ¬åœ°è·¯å¾„\r\n   $ go mod edit -replace github.com/onnttf/greetings=../greetings\r\n\r\n   # æ›´æ–°ä¾èµ–å…³ç³»\r\n   $ go mod tidy\r\n   ```\r\n\r\n   æ­¤æ—¶ `go.mod` æ–‡ä»¶åº”è¯¥åŒ…å«ï¼š\r\n\r\n   ```go\r\n   module github.com/onnttf/hello\r\n\r\n   go 1.22.6\r\n\r\n   replace github.com/onnttf/greetings => ../greetings\r\n   require github.com/onnttf/greetings v0.0.0-00010101000000-000000000000\r\n   ```\r\n\r\n4. è¿è¡Œç¨‹åº\r\n\r\n   ```bash\r\n   $ go run hello.go\r\n   Hi, Mike. Welcome!\r\n   ```\r\n\r\n### å‘å¸ƒæ¨¡å—\r\n\r\nè¦è®©å…¶ä»–å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å—ï¼Œéœ€è¦å°†å…¶å‘å¸ƒåˆ°ä»£ç æ‰˜ç®¡å¹³å°ï¼Œå¦‚ GitHubã€GitLab ç­‰ã€‚\r\n\r\n1. åˆå§‹åŒ– Git ä»“åº“\r\n\r\n   ```bash\r\n   cd ../greetings/\r\n   git init\r\n   git add .\r\n   git commit -m \"feat: åˆå§‹åŒ– greetings æ¨¡å—\"\r\n   ```\r\n\r\n2. æ¨é€åˆ°è¿œç¨‹ä»“åº“\r\n\r\n   ```bash\r\n   git branch -M main\r\n   git remote add origin git@github.com:onnttf/greetings.git\r\n   git push -u origin main\r\n   ```\r\n\r\n3. åˆ›å»ºå‘å¸ƒç‰ˆæœ¬\r\n\r\n   ```bash\r\n   # åˆ›å»ºå¹¶æ¨é€æ ‡ç­¾\r\n   git tag v0.1.0\r\n   git push origin v0.1.0\r\n\r\n   # æ›´æ–°æ¨¡å—ç´¢å¼•\r\n   $ GOPROXY=proxy.golang.org go list -m github.com/onnttf/greetings@v0.1.0\r\n   ```\r\n\r\nå®Œæˆå‘å¸ƒï¼ç°åœ¨å…¶ä»–å¼€å‘è€…å¯ä»¥é€šè¿‡ `go get github.com/onnttf/greetings` æ¥ä½¿ç”¨è¿™ä¸ªæ¨¡å—äº†ï¼Œæ¨¡å—ä¿¡æ¯ä¹Ÿå¯ä»¥åœ¨ [pkg.go.dev](https://pkg.go.dev/) ä¸ŠæŸ¥çœ‹ã€‚\r\n\r\n## go mod æ˜¯ä»€ä¹ˆ\r\n\r\n`go mod` æ˜¯ Go è¯­è¨€ä¸­çš„ä¸€ç»„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† Go Modules çš„ä¾èµ–å…³ç³»ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„å­å‘½ä»¤æ¥ç®€åŒ–æ¨¡å—ç®¡ç†å·¥ä½œã€‚\r\n\r\n```bash\r\nâ¯ go mod\r\nGo mod provides access to operations on modules.\r\n\r\nNote that support for modules is built into all the go commands,\r\nnot just 'go mod'. For example, day-to-day adding, removing, upgrading,\r\nand downgrading of dependencies should be done using 'go get'.\r\nSee 'go help modules' for an overview of module functionality.\r\n\r\nUsage:\r\n\r\n        go mod <command> [arguments]\r\n\r\nThe commands are:\r\n\r\n        download    download modules to local cache\r\n        edit        edit go.mod from tools or scripts\r\n        graph       print module requirement graph\r\n        init        initialize new module in current directory\r\n        tidy        add missing and remove unused modules\r\n        vendor      make vendored copy of dependencies\r\n        verify      verify dependencies have expected content\r\n        why         explain why packages or modules are needed\r\n\r\nUse \"go help mod <command>\" for more information about a command.\r\n```\r\n\r\n## go.mod æ–‡ä»¶è¯¦è§£\r\n\r\n`go.mod` æ˜¯æ¨¡å—çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†ï¼š\r\n\r\n1. **æ¨¡å—è·¯å¾„**ï¼šå”¯ä¸€æ ‡è¯†è¯¥æ¨¡å—çš„å¯¼å…¥è·¯å¾„\r\n2. **Go ç‰ˆæœ¬**ï¼šæ¨¡å—ä½¿ç”¨çš„ Go è¯­è¨€ç‰ˆæœ¬\r\n3. **ä¾èµ–å…³ç³»**ï¼š\r\n   - requireï¼šæŒ‡å®šç›´æ¥ä¾èµ–\r\n   - replaceï¼šæ›¿æ¢ä¾èµ–çš„ç‰ˆæœ¬æˆ–è·¯å¾„\r\n   - excludeï¼šæ’é™¤ç‰¹å®šç‰ˆæœ¬çš„ä¾èµ–\r\n\r\nç¤ºä¾‹ï¼š\r\n\r\n```go\r\nmodule example.com/mymodule\r\n\r\ngo 1.16\r\n\r\nrequire (\r\n    github.com/pkg/errors v0.9.1\r\n    golang.org/x/text v0.3.7\r\n)\r\n\r\nreplace example.com/old-module => example.com/new-module v1.0.0\r\n```\r\n\r\n## é…ç½®æ¨¡å—ä»£ç†\r\n\r\nç”±äºç½‘ç»œåŸå› ï¼Œç›´æ¥ä» `proxy.golang.org` ä¸‹è½½æ¨¡å—å¯èƒ½ä¼šå¤±è´¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å›½å†…é•œåƒæ¥åŠ é€Ÿä¾èµ–ä¸‹è½½ï¼š\r\n\r\n```bash\r\n# å¼€å¯ Go modules\r\ngo env -w GO111MODULE=on\r\n\r\n# ä½¿ç”¨ä¸ƒç‰›äº‘çš„ä»£ç†æœåŠ¡å™¨\r\ngo env -w GOPROXY=https://goproxy.cn,direct\r\n\r\n# æˆ–ä½¿ç”¨é˜¿é‡Œäº‘çš„ä»£ç†æœåŠ¡å™¨\r\ngo env -w GOPROXY=https://mirrors.aliyun.com/goproxy/,direct\r\n```\r\n\r\né…ç½®åï¼ŒGo å·¥å…·é“¾ä¼šä¼˜å…ˆä»æŒ‡å®šçš„ä»£ç†æœåŠ¡å™¨ä¸‹è½½ä¾èµ–ã€‚\r\n\r\n## ç§æœ‰æ¨¡å—ç®¡ç†\r\n\r\nå¯¹äºä¼ä¸šå†…éƒ¨çš„ç§æœ‰æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦ï¼š\r\n\r\n1. é…ç½® GOPRIVATE ç¯å¢ƒå˜é‡è·³è¿‡å…¬å…±ä»£ç†\r\n\r\n   ```bash\r\n   # å•ä¸ªåŸŸå\r\n   go env -w GOPRIVATE=git.company.com\r\n\r\n   # å¤šä¸ªåŸŸå\r\n   go env -w GOPRIVATE=*.company.com,*.corp.example.com\r\n   ```\r\n\r\n2. é…ç½® git è®¤è¯ï¼ˆå¦‚æœéœ€è¦ï¼‰\r\n\r\n   ```bash\r\n   git config --global url.\"git@git.company.com:\".insteadOf \"https://git.company.com/\"\r\n   ```\r\n\r\nè¿™æ ·è®¾ç½®åï¼š\r\n\r\n- åŒ¹é… GOPRIVATE çš„æ¨¡å—å°†ç›´æ¥ä»æºä»“åº“æ‹‰å–\r\n- ç§æœ‰æ¨¡å—çš„ä¾èµ–è§£æä¸ç‰ˆæœ¬æ§åˆ¶æ›´åŠ å®‰å…¨å¯é \r\n- é¿å…äº†å†…éƒ¨ä»£ç æ³„éœ²çš„é£é™©\r\n\r\n## æœ€å\r\n\r\nGo Modules ä½œä¸º Go è¯­è¨€å®˜æ–¹æ¨å‡ºçš„ä¾èµ–ç®¡ç†æ–¹æ¡ˆã€‚å®ƒé€šè¿‡æ™ºèƒ½åŒ–çš„ç‰ˆæœ¬ç®¡ç†ã€æ¸…æ™°çš„ä¾èµ–è¿½è¸ªä»¥åŠçµæ´»çš„é¡¹ç›®ç»“æ„ï¼Œè®©ä¾èµ–ç®¡ç†å˜å¾—è½»æ¾è‡ªå¦‚ã€‚\r\n","number":26,"labels":{"nodes":[{"id":"LA_kwDONzrbkM8AAAAB4wxDEQ","name":"golang","url":"https://github.com/onnttf/blog/labels/golang"}]},"category":{"id":"DIC_kwDONzrbkM4Cmnbf","name":"Show and tell","slug":"show-and-tell","emoji":":raised_hands:","emojiHTML":"<div>ğŸ™Œ</div>"},"author":{"login":"onnttf"},"authorAssociation":"OWNER","createdAt":"2022-02-01T08:00:00Z","updatedAt":"2025-02-05T11:52:01Z","repository":{"id":"R_kgDONzrbkA","url":"https://github.com/onnttf/blog"},"url":"https://github.com/onnttf/blog/discussions/26","jsonFilePath":"discussions/26-D_kwDONzrbkM4AeNb4.json","markdownFilePath":"2022/02/26-D_kwDONzrbkM4AeNb4.md"}
